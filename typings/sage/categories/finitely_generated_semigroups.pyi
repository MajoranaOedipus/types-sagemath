from sage.categories.category_with_axiom import CategoryWithAxiom as CategoryWithAxiom
from sage.categories.enumerated_sets import EnumeratedSets as EnumeratedSets
from sage.categories.semigroups import Semigroups as Semigroups
from sage.misc.abstract_method import abstract_method as abstract_method
from sage.misc.cachefunc import cached_method as cached_method

class FinitelyGeneratedSemigroups(CategoryWithAxiom):
    """
    The category of finitely generated (multiplicative) semigroups.

    A :class:`finitely generated semigroup <Semigroups>` is a
    :class:`semigroup <Semigroups>` endowed with a distinguished
    finite set of generators (see
    :meth:`FinitelyGeneratedSemigroups.ParentMethods.semigroup_generators`).
    This makes it into an :class:`enumerated set <EnumeratedSets>`.

    EXAMPLES::

        sage: C = Semigroups().FinitelyGenerated(); C
        Category of finitely generated semigroups
        sage: C.super_categories()
        [Category of semigroups,
         Category of finitely generated magmas,
         Category of enumerated sets]
        sage: sorted(C.axioms())
        ['Associative', 'Enumerated', 'FinitelyGeneratedAsMagma']
        sage: C.example()
        An example of a semigroup: the free semigroup generated
        by ('a', 'b', 'c', 'd')

    TESTS::

        sage: TestSuite(C).run()
    """
    @cached_method
    def extra_super_categories(self):
        """
        State that a finitely generated semigroup is endowed with a
        default enumeration.

        EXAMPLES::

            sage: Semigroups().FinitelyGenerated().extra_super_categories()
            [Category of enumerated sets]
        """
    def example(self):
        """
        EXAMPLES::

            sage: Semigroups().FinitelyGenerated().example()
            An example of a semigroup: the free semigroup generated
            by ('a', 'b', 'c', 'd')
        """
    class ParentMethods:
        @abstract_method
        def semigroup_generators(self) -> None:
            """
            Return distinguished semigroup generators for ``self``.

            OUTPUT: a finite family

            This method should be implemented by all semigroups in
            :class:`FinitelyGeneratedSemigroups`.

            EXAMPLES::

                sage: S = FiniteSemigroups().example()
                sage: S.semigroup_generators()
                Family ('a', 'b', 'c', 'd')
            """
        def succ_generators(self, side: str = 'twosided'):
            '''
            Return the successor function of the ``side``-sided Cayley
            graph of ``self``.

            This is a function that maps an element of ``self`` to all
            the products of ``x`` by a generator of this semigroup,
            where the product is taken on the left, right, or both
            sides.

            INPUT:

            - ``side`` -- ``\'left\'``, ``\'right\'``, or ``\'twosided\'`` (default)

            .. TODO:: Design choice:

               - find a better name for this method
               - should we return a set? a family?

            EXAMPLES::

                sage: S = FiniteSemigroups().example()
                sage: S.succ_generators("left" )(S(\'ca\'))
                (\'ac\', \'bca\', \'ca\', \'dca\')
                sage: S.succ_generators("right")(S(\'ca\'))
                (\'ca\', \'cab\', \'ca\', \'cad\')
                sage: S.succ_generators("twosided" )(S(\'ca\'))
                (\'ac\', \'bca\', \'ca\', \'dca\', \'ca\', \'cab\', \'ca\', \'cad\')
            '''
        def __iter__(self):
            """
            Return an iterator over the elements of ``self``.

            This brute force implementation recursively multiplies
            together the distinguished semigroup generators.

            .. SEEALSO:: :meth:`semigroup_generators`

            EXAMPLES::

                sage: S = FiniteSemigroups().example(alphabet=('x','y'))
                sage: it = S.__iter__()
                sage: sorted(it)
                ['x', 'xy', 'y', 'yx']
            """
        def ideal(self, gens, side: str = 'twosided'):
            '''
            Return the ``side``-sided ideal generated by ``gens``.

            This brute force implementation recursively multiplies the
            elements of ``gens`` by the distinguished generators of
            this semigroup.

            .. SEEALSO:: :meth:`semigroup_generators`

            INPUT:

            - ``gens`` -- list (or iterable) of elements of ``self``
            - ``side`` -- [default: "twosided"] "left", "right" or "twosided"

            EXAMPLES::

                sage: S = FiniteSemigroups().example()
                sage: sorted(S.ideal([S(\'cab\')], side=\'left\'))
                [\'abc\', \'abcd\', \'abdc\', \'acb\', \'acbd\', \'acdb\', \'adbc\',
                 \'adcb\', \'bac\', \'bacd\', \'badc\', \'bca\', \'bcad\', \'bcda\',
                 \'bdac\', \'bdca\', \'cab\', \'cabd\', \'cadb\', \'cba\', \'cbad\',
                 \'cbda\', \'cdab\', \'cdba\', \'dabc\', \'dacb\', \'dbac\', \'dbca\',
                 \'dcab\', \'dcba\']
                sage: list(S.ideal([S(\'cab\')], side=\'right\'))
                [\'cab\', \'cabd\']
                sage: sorted(S.ideal([S(\'cab\')], side=\'twosided\'))
                [\'abc\', \'abcd\', \'abdc\', \'acb\', \'acbd\', \'acdb\', \'adbc\',
                 \'adcb\', \'bac\', \'bacd\', \'badc\', \'bca\', \'bcad\', \'bcda\',
                 \'bdac\', \'bdca\', \'cab\', \'cabd\', \'cadb\', \'cba\', \'cbad\',
                 \'cbda\', \'cdab\', \'cdba\', \'dabc\', \'dacb\', \'dbac\', \'dbca\',
                 \'dcab\', \'dcba\']
                sage: sorted(S.ideal([S(\'cab\')]))
                [\'abc\', \'abcd\', \'abdc\', \'acb\', \'acbd\', \'acdb\', \'adbc\',
                 \'adcb\', \'bac\', \'bacd\', \'badc\', \'bca\', \'bcad\', \'bcda\',
                 \'bdac\', \'bdca\', \'cab\', \'cabd\', \'cadb\', \'cba\', \'cbad\',
                 \'cbda\', \'cdab\', \'cdba\', \'dabc\', \'dacb\', \'dbac\', \'dbca\',
                 \'dcab\', \'dcba\']
            '''
    class Finite(CategoryWithAxiom):
        class ParentMethods:
            def some_elements(self):
                """
                Return an iterable containing some elements of the semigroup.

                OUTPUT: the ten first elements of the semigroup, if they exist

                EXAMPLES::

                    sage: S = FiniteSemigroups().example(alphabet=('x','y'))
                    sage: sorted(S.some_elements())
                    ['x', 'xy', 'y', 'yx']
                    sage: S = FiniteSemigroups().example(alphabet=('x','y','z'))
                    sage: X = S.some_elements()
                    sage: len(X)
                    10
                    sage: all(x in S for x in X)
                    True
                """
